<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Dunyoni o‚Äòrganamiz</title>

  <style>
    :root{
      --bg1:#b7f3ff;
      --bg2:#ffe7b6;
      --card:#ffffff;
      --border:#e8e8ff;
      --text:#1f2937;
      --muted:#6b7280;
      --shadow: 0 18px 40px rgba(0,0,0,.12);
      --radius: 22px;

      --g1:#7cfff3;
      --g2:#8b5cf6;
      --y1:#ffd54f;
      --y2:#ffb74d;

      --ok:#22c55e;
      --bad:#ef4444;

      --board1:#f3e7d3;
      --board2:#7a4a2a;
      --boardBorder:#e8e8ff;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Comic Sans MS","Segoe UI",system-ui,Arial,sans-serif;
      color:var(--text);
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      overflow-x:hidden;
    }

    /* animated geo background */
    .bg{ position:fixed; inset:0; pointer-events:none; overflow:hidden; }
    .blob{ position:absolute; width:420px;height:420px;border-radius:50%; opacity:.30; animation: float 10s ease-in-out infinite; }
    .b1{background:rgba(124,255,243,.55); left:-120px; top:-120px; animation-duration: 11s;}
    .b2{background:rgba(139,92,246,.45); right:-140px; top:20px; animation-duration: 13s;}
    .b3{background:rgba(255,213,79,.45); left:20%; bottom:-180px; animation-duration: 12s;}
    @keyframes float{ 50%{ transform: translateY(18px) translateX(12px) } }

    .icons{ position:absolute; inset:0; opacity:.55; }
    .geo{ position:absolute; font-size:22px; animation: drift 12s linear infinite; filter: drop-shadow(0 10px 14px rgba(0,0,0,.10)); }
    @keyframes drift{ from{transform:translateY(40px)} to{transform:translateY(-60px)} }

    .wrap{
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:16px;
      padding-bottom:22px;
    }
    .app{ width:min(980px,100%); display:grid; gap:12px; align-content:start; }

    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background: rgba(255,255,255,.80);
      border: 2px solid rgba(255,255,255,.92);
      border-radius: 999px;
      padding: 10px 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,.08);
      backdrop-filter: blur(8px);
      position: sticky; top:10px; z-index:5;
    }
    .brand{ display:flex; align-items:center; gap:10px; }
    .logo{
      width:40px;height:40px;border-radius:16px;
      background: linear-gradient(135deg, #ff7ab6, #7cfff3);
      border: 2px solid rgba(255,255,255,.85);
      box-shadow: 0 10px 18px rgba(0,0,0,.10);
      display:flex; align-items:center; justify-content:center;
      font-size:20px;
    }
    .title{ font-weight:1000; font-size:16px; }
    .subtitle{ font-weight:900; font-size:12px; color:var(--muted); margin-top:2px; }

    .lang{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .seg{
      display:flex; border-radius:999px; overflow:hidden;
      border:2px solid rgba(255,255,255,.95);
      box-shadow:0 8px 16px rgba(0,0,0,.06);
      background: rgba(255,255,255,.88);
    }
    .seg button{ border:none; padding:9px 12px; font-weight:1000; cursor:pointer; background:transparent; }
    .seg button.active{ background: linear-gradient(135deg, var(--g1), var(--g2)); color:#0b1220; }

    .card{
      background: rgba(255,255,255,.92);
      border: 3px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    .card:before,.card:after{
      content:""; position:absolute; width:260px;height:260px;border-radius:50%;
      background: rgba(255,213,79,.20); top:-120px;left:-120px;
    }
    .card:after{ background: rgba(124,255,243,.18); top:auto;left:auto; bottom:-120px;right:-120px; }
    .inner{ position:relative; display:grid; gap:10px; }

    .sectionTitle{ font-weight:1000; font-size:18px; margin:2px 0; }

    .grid3{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
    @media (max-width:820px){ .grid3{ grid-template-columns:1fr; } }

    .bigBtn{
      width:100%;
      border:3px solid rgba(31,41,55,.10);
      border-radius:18px;
      padding:14px;
      cursor:pointer;
      font-weight:1000;
      font-size:16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      box-shadow:0 10px 18px rgba(0,0,0,.08);
      text-align:left;
      transition: transform .08s ease, filter .18s ease;
      min-height:70px;
    }
    .bigBtn:hover{ filter:brightness(1.03); }
    .bigBtn:active{ transform:scale(.99); }

    .btnTest{ background: linear-gradient(180deg, var(--y1), var(--y2)); }
    .btnCheckers{ background: linear-gradient(135deg, #ff7ab6, #ffd54f); }

    .left{ display:flex; align-items:center; gap:12px; min-width:0; }
    .badge{
      width:42px;height:42px;border-radius:16px;
      background: rgba(255,255,255,.65);
      border:2px solid rgba(255,255,255,.85);
      display:flex; align-items:center; justify-content:center;
      font-weight:1000; font-size:18px; flex:0 0 auto;
    }
    .circleBadge{
      width:42px;height:42px;border-radius:999px;
      background: rgba(255,255,255,.65);
      border:2px solid rgba(255,255,255,.85);
      display:flex; align-items:center; justify-content:center;
      font-weight:1000; font-size:18px; flex:0 0 auto;
    }
    .t2{ font-size:12px; font-weight:900; color:var(--muted); margin-top:2px; }

    .screen{ display:none; }
    .screen.active{ display:block; }

    /* Quiz */
    .row{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    .pill{
      background: rgba(255,255,255,.90);
      border:2px solid rgba(255,255,255,.95);
      border-radius:999px;
      padding:8px 12px;
      box-shadow:0 8px 16px rgba(0,0,0,.06);
      font-weight:1000;
      font-size:13px;
      white-space:nowrap;
      cursor:pointer;
    }
    .progress{
      flex:1; min-width:220px;
      height:14px;
      border-radius:999px;
      background:#eef2ff;
      border:2px solid #e0e7ff;
      overflow:hidden;
    }
    .bar{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, #22c55e, #3b82f6);
      transition: width .25s ease;
    }
    .q{ font-size: clamp(20px,3vw,30px); font-weight:1000; margin:4px 0 0; }
    .hint{ margin:0; font-size:14px; font-weight:900; color:var(--muted); }

    .answers{ display:grid; gap:10px; }
    .ans{
      width:100%;
      border:3px solid rgba(31,41,55,.12);
      border-radius:18px;
      padding:14px;
      background: linear-gradient(180deg, var(--y1), var(--y2));
      cursor:pointer;
      font-weight:1000;
      font-size:16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      box-shadow:0 10px 18px rgba(0,0,0,.08);
      text-align:left;
      transition: transform .08s ease, filter .18s ease;
    }
    .ans:hover{ filter:brightness(1.03); }
    .ans:active{ transform:scale(.99); }
    .ans[disabled]{ cursor:not-allowed; opacity:.98; }
    .state{ min-height:26px; font-weight:1000; font-size:16px; }

    .footerAuthor{
      text-align:center;
      color: rgba(31,41,55,.55);
      font-weight:900;
      font-size:12px;
      padding: 6px 8px 0;
    }

    /* ===== CHECKERS ===== */
    .checkersWrap{
      display:grid;
      gap: 12px;
    }
    .formGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width:820px){
      .formGrid{ grid-template-columns: 1fr; }
    }
    .field{
      background: rgba(255,255,255,.90);
      border: 2px solid rgba(255,255,255,.95);
      border-radius: 16px;
      padding: 10px 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,.06);
    }
    .field label{
      display:block;
      font-weight: 1000;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .field input, .field select{
      width:100%;
      border: 2px solid rgba(31,41,55,.10);
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 1000;
      font-size: 15px;
      outline: none;
      background: #fff;
    }
    .modeRow{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
    }
    .modeBtn{
      border:none;
      border-radius: 999px;
      padding: 10px 12px;
      font-weight: 1000;
      cursor:pointer;
      background: #eef2ff;
      box-shadow: 0 10px 18px rgba(0,0,0,.08);
    }
    .modeBtn.active{
      background: linear-gradient(135deg, var(--g1), var(--g2));
      color:#0b1220;
    }
    .startBtn{
      border:none;
      border-radius: 18px;
      padding: 14px;
      font-weight: 1000;
      font-size: 16px;
      cursor:pointer;
      background: linear-gradient(135deg, #ff7ab6, #ffd54f);
      box-shadow: 0 14px 24px rgba(0,0,0,.10);
    }

    /* Fullscreen board area */
    .boardScreen{
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      z-index: 50;
      display:none;
      padding: env(safe-area-inset-top) 14px env(safe-area-inset-bottom) 14px;
    }
    .boardScreen.active{ display:grid; }
    .boardTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 10px 10px;
      background: rgba(255,255,255,.82);
      border: 2px solid rgba(255,255,255,.92);
      border-radius: 999px;
      box-shadow: 0 10px 25px rgba(0,0,0,.08);
      backdrop-filter: blur(8px);
    }
    .turn{
      font-weight:1000;
      font-size: 13px;
      color: var(--muted);
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap:wrap;
    }
    .turn b{ color: var(--text); }

    .boardArea{
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 12px 0 0;
      height: calc(100vh - 86px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
    }

    .board{
      width: min(92vw, 92vh);
      height: min(92vw, 92vh);
      border-radius: 22px;
      border: 3px solid var(--boardBorder);
      box-shadow: 0 24px 60px rgba(0,0,0,.18);
      overflow:hidden;
      background: #fff;
      display:grid;
      grid-template-columns: repeat(8, 1fr);
      grid-template-rows: repeat(8, 1fr);
      position:relative;
    }
    .cell{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .light{ background: linear-gradient(180deg, #fff6ea, var(--board1)); }
    .dark{ background: linear-gradient(180deg, #8b5a3b, var(--board2)); }
    .cell.dark:hover{ filter: brightness(1.03); }

    .piece{
      width: 72%;
      height: 72%;
      border-radius: 999px;
      position:relative;
      box-shadow:
        0 12px 18px rgba(0,0,0,.18),
        inset 0 4px 8px rgba(255,255,255,.25);
      display:flex;
      align-items:center;
      justify-content:center;
      border: 2px solid rgba(255,255,255,.20);
    }
    .p1{
      background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.35), transparent 45%),
                  linear-gradient(180deg, #ff5c86, #a60f2f);
    }
    .p2{
      background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.35), transparent 45%),
                  linear-gradient(180deg, #4b5563, #111827);
    }
    .king{
      outline: 3px solid rgba(255,255,255,.55);
    }
    .crown{
      font-size: 18px;
      filter: drop-shadow(0 6px 8px rgba(0,0,0,.25));
    }

    .selected{
      outline: 4px solid rgba(124,255,243,.95);
      outline-offset: 2px;
    }
    .hintMove{
      width: 42%;
      height: 42%;
      border-radius: 999px;
      background: rgba(124,255,243,.55);
      border: 3px solid rgba(255,255,255,.45);
      box-shadow: 0 10px 18px rgba(0,0,0,.14);
    }
    .hintCapture{
      background: rgba(255,122,182,.55);
    }

    .endModal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 80;
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(6px);
    }
    .endModal.active{ display:flex; }
    .endCard{
      width: min(520px, 100%);
      background: rgba(255,255,255,.92);
      border: 3px solid var(--border);
      border-radius: 22px;
      box-shadow: 0 24px 60px rgba(0,0,0,.18);
      padding: 16px;
    }
    .endCard h2{
      margin: 0 0 6px;
      font-weight:1000;
    }
    .endCard p{
      margin: 0 0 12px;
      font-weight: 900;
      color: var(--muted);
    }
    .endActions{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
    }
    .endActions button{
      border:none;
      border-radius: 16px;
      padding: 12px 14px;
      font-weight: 1000;
      cursor:pointer;
      box-shadow: 0 10px 18px rgba(0,0,0,.08);
    }
    .btnPrimary{
      background: linear-gradient(135deg, var(--g1), var(--g2));
    }
    .btnSecondary{
      background: #eef2ff;
    }
  </style>
</head>

<body>
  <div class="bg">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="icons">
      <div class="geo" style="left:8%; top:78%; animation-duration: 13s;">üß≠</div>
      <div class="geo" style="left:20%; top:60%; animation-duration: 11s;">üó∫Ô∏è</div>
      <div class="geo" style="left:35%; top:70%; animation-duration: 12s;">üìç</div>
      <div class="geo" style="left:55%; top:68%; animation-duration: 14s;">üèîÔ∏è</div>
      <div class="geo" style="left:72%; top:76%; animation-duration: 12s;">üåã</div>
      <div class="geo" style="left:85%; top:62%; animation-duration: 15s;">üåä</div>
    </div>
  </div>

  <div class="wrap">
    <div class="app">

      <!-- TOPBAR -->
      <div class="topbar">
        <div class="brand">
          <div class="logo">üåç</div>
          <div>
            <div class="title" id="topTitle">Dunyoni o‚Äòrganamiz</div>
            <div class="subtitle" id="topSub">o‚Äòynab o‚Äòrganamiz ‚≠ê</div>
          </div>
        </div>

        <div class="lang">
          <div class="seg">
            <button id="btnUz" class="active">O‚Äòzbek</button>
            <button id="btnRu">–†—É—Å</button>
          </div>
        </div>
      </div>

      <!-- HOME -->
      <div class="card screen active" id="home">
        <div class="inner">
          <div class="sectionTitle" id="blockTitle">Bilimingizni sinab ko‚Äòring</div>

          <div class="grid3">
            <button class="bigBtn btnTest" id="goGeo">
              <div class="left">
                <div class="badge">üåç</div>
                <div>
                  <div id="geoTitle" style="font-weight:1000;">Geografiya testi</div>
                  <div class="t2" id="geoDesc">10 ta savol</div>
                </div>
              </div>
              <div class="arrow">‚û°Ô∏è</div>
            </button>

            <button class="bigBtn btnTest" id="goMath">
              <div class="left">
                <div class="badge">‚ûï</div>
                <div>
                  <div id="mathTitle" style="font-weight:1000;">Matematika testi</div>
                  <div class="t2" id="mathDesc">10 ta savol</div>
                </div>
              </div>
              <div class="arrow">‚û°Ô∏è</div>
            </button>

            <button class="bigBtn btnTest" id="goAnimals">
              <div class="left">
                <div class="badge">üêæ</div>
                <div>
                  <div id="aniTitle" style="font-weight:1000;">Hayvonot olami</div>
                  <div class="t2" id="aniDesc">10 ta savol</div>
                </div>
              </div>
              <div class="arrow">‚û°Ô∏è</div>
            </button>
          </div>

          <div class="sectionTitle" id="gamesTitle">O‚Äòyinlar</div>

          <button class="bigBtn btnCheckers" id="goCheckers">
            <div class="left">
              <div class="circleBadge">‚ö´</div>
              <div>
                <div id="checkTitle" style="font-weight:1000;">Shashka</div>
                <div class="t2" id="checkDesc">Do‚Äòst bilan yoki Robot bilan o‚Äòynash</div>
              </div>
            </div>
            <div class="arrow">‚û°Ô∏è</div>
          </button>

          <div class="footerAuthor" id="author">
            O‚Äòzbekiston milliy pedagogika universiteti ‚Ä¢ Tabiiy fanlar fakulteti ‚Ä¢ 1-kurs talabasi ‚Ä¢ Azimjon Tashpulatov
          </div>
        </div>
      </div>

      <!-- QUIZ -->
      <div class="card screen" id="quiz">
        <div class="inner">
          <div class="row">
            <div class="pill"><span id="ballText">Ball</span>: <span id="score">0</span></div>
            <div class="pill"><span id="qText">Savol</span>: <span id="qnum">1</span>/<span id="qtotal">10</span></div>
            <div class="progress"><div class="bar" id="bar"></div></div>
            <button class="pill" id="backHome">üè† <span id="homeText">Bosh sahifa</span></button>
          </div>

          <h2 class="q" id="question">Savol</h2>
          <p class="hint" id="hint">Javobni tanlang üëá</p>

          <div class="answers" id="answers"></div>
          <div class="state" id="state"></div>
        </div>
      </div>

      <!-- CHECKERS SETTINGS -->
      <div class="card screen" id="checkers">
        <div class="inner checkersWrap">
          <div class="row">
            <div class="sectionTitle" id="checkersHead">Shashka</div>
            <button class="pill" id="backHome2">üè† <span id="homeText2">Bosh sahifa</span></button>
          </div>

          <div class="field">
            <label id="modeLabel">Rejim</label>
            <div class="modeRow">
              <button class="modeBtn active" id="modeFriend">üë´ <span id="friendText">Do‚Äòst bilan</span></button>
              <button class="modeBtn" id="modeRobot">ü§ñ <span id="robotText">Robot bilan o‚Äòynash</span></button>
            </div>
          </div>

          <div class="formGrid">
            <div class="field">
              <label id="p1Label">1-o‚Äòyinchi ismi</label>
              <input id="p1Name" placeholder="Masalan: Ali" />
            </div>

            <div class="field" id="p2Field">
              <label id="p2Label">2-o‚Äòyinchi ismi</label>
              <input id="p2Name" placeholder="Masalan: Vali" />
            </div>

            <div class="field" id="levelField" style="display:none;">
              <label id="levelLabel">Robot darajasi</label>
              <select id="level">
                <option value="easy" id="lvEasy">Yengil</option>
                <option value="mid" id="lvMid">O‚Äòrtacha</option>
                <option value="hard" id="lvHard">Qiyin</option>
              </select>
            </div>
          </div>

          <button class="startBtn" id="startCheckers">‚ñ∂Ô∏è <span id="startText">Boshlash</span></button>

          <div class="pill" id="rulesNote">
            ‚úÖ Qoidalar: urish (olish) majburiy, ketma-ket urish majburiy, damka urilsa ‚Äî o‚Äòchadi.
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- FULLSCREEN BOARD -->
  <div class="boardScreen" id="boardScreen">
    <div class="boardTop">
      <div class="turn" id="turnInfo"></div>
      <div class="turn">
        <button class="pill" id="exitBoard">‚üµ <span id="exitText">Chiqish</span></button>
      </div>
    </div>

    <div class="boardArea">
      <div class="board" id="board"></div>
    </div>
  </div>

  <!-- END MODAL -->
  <div class="endModal" id="endModal">
    <div class="endCard">
      <h2 id="endTitle">üèÜ</h2>
      <p id="endSub"></p>
      <div class="endActions">
        <button class="btnPrimary" id="playAgain">üîÑ <span id="againText">Yana o‚Äòynash</span></button>
        <button class="btnSecondary" id="goMenu">üè† <span id="menuText">Menyu</span></button>
      </div>
    </div>
  </div>

  <script>
    // ===== i18n =====
    const I18N = {
      uz: {
        topTitle: "Dunyoni o‚Äòrganamiz",
        topSub: "o‚Äòynab o‚Äòrganamiz ‚≠ê",
        blockTitle: "Bilimingizni sinab ko‚Äòring",
        geoTitle: "Geografiya testi",
        geoDesc: "10 ta savol",
        mathTitle: "Matematika testi",
        mathDesc: "10 ta savol",
        aniTitle: "Hayvonot olami",
        aniDesc: "10 ta savol",
        gamesTitle: "Aqliy o`yin",
        checkTitle: "Shashka",
        checkDesc: "Do‚Äòst bilan yoki Robot bilan o‚Äòynash",
        author: "Nizomiy nomidagi O‚Äòzbekiston milliy pedagogika universiteti Tabiiy fanlar fakulteti 101-guruh (kechki) 1-kurs talabasi TashpulatovAzimjon ",

        ball: "Ball",
        q: "Savol",
        home: "Bosh sahifa",
        hint: "Javobni tanlang üëá",
        correctMsg: "‚úÖ To‚Äòg‚Äòri!",
        wrongMsg: "‚ùå Noto‚Äòg‚Äòri!",
        doneTitle: "üèÜ Tayyor!",
        doneText: "Natija",
        replay: "üîÑ Qayta o‚Äòynash",

        // checkers UI
        mode: "Rejim",
        friend: "Do‚Äòst bilan",
        robot: "Robot bilan o‚Äòynash",
        p1: "1-o‚Äòyinchi ismi",
        p2: "2-o‚Äòyinchi ismi",
        level: "Robot darajasi",
        lvEasy: "Yengil",
        lvMid: "O‚Äòrtacha",
        lvHard: "Qiyin",
        start: "Boshlash",
        exit: "Chiqish",
        turn: "Navbat",
        mustCapture: "Urish majburiy!",
        youWin: "Siz yutdingiz! üéâ",
        youLose: "Siz yutqazdingiz üôÇ",
        draw: "Durang",
        again: "Yana o‚Äòynash",
        menu: "Menyu",
        rules: "‚úÖ Qoidalar: urish (olish) majburiy, ketma-ket urish majburiy, damka urilsa ‚Äî o‚Äòchadi.",
      },
      ru: {
        topTitle: "–ò–∑—É—á–∞–µ–º –º–∏—Ä",
        topSub: "—É—á–∏–º—Å—è –∏–≥—Ä–∞—è ‚≠ê",
        blockTitle: "–ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è",
        geoTitle: "–¢–µ—Å—Ç –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏",
        geoDesc: "10 –≤–æ–ø—Ä–æ—Å–æ–≤",
        mathTitle: "–¢–µ—Å—Ç –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ",
        mathDesc: "10 –≤–æ–ø—Ä–æ—Å–æ–≤",
        aniTitle: "–ú–∏—Ä –∂–∏–≤–æ—Ç–Ω—ã—Ö",
        aniDesc: "10 –≤–æ–ø—Ä–æ—Å–æ–≤",
        gamesTitle: "–ò–≥—Ä–∞ —Ä–∞–∑—É–º–∞",
        checkTitle: "–®–∞—à–∫–∏",
        checkDesc: "–° –¥—Ä—É–≥–æ–º –∏–ª–∏ ¬´–∏–≥—Ä–∞–π —Å —Ä–æ–±–æ—Ç–æ–º¬ª",
        author: "–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–∞ –∏–º–µ–Ω–∏ –ù–∏–∑–∞–º–∏ –§–∞–∫—É–ª—å—Ç–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–∞—É–∫ 101-–≥—Ä—É–ø–ø–∞ (–≤–µ—á–µ—Ä–Ω—ã–π) 1 –∫—É—Ä—Å –¢–∞—à–ø—É–ª–∞—Ç–æ–≤ –ê–∑–∏–º–∂–æ–Ω",

        ball: "Ball",
        q: "–í–æ–ø—Ä–æ—Å",
        home: "–ì–ª–∞–≤–Ω–∞—è",
        hint: "–í—ã–±–µ—Ä–∏ –æ—Ç–≤–µ—Ç üëá",
        correctMsg: "‚úÖ –í–µ—Ä–Ω–æ!",
        wrongMsg: "‚ùå –ù–µ–≤–µ—Ä–Ω–æ!",
        doneTitle: "üèÜ –ì–æ—Ç–æ–≤–æ!",
        doneText: "–†–µ–∑—É–ª—å—Ç–∞—Ç",
        replay: "üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞",

        // checkers UI
        mode: "–†–µ–∂–∏–º",
        friend: "–° –¥—Ä—É–≥–æ–º",
        robot: "–ò–≥—Ä–∞–π —Å —Ä–æ–±–æ—Ç–æ–º",
        p1: "–ò–º—è –∏–≥—Ä–æ–∫–∞ 1",
        p2: "–ò–º—è –∏–≥—Ä–æ–∫–∞ 2",
        level: "–£—Ä–æ–≤–µ–Ω—å —Ä–æ–±–æ—Ç–∞",
        lvEasy: "–õ—ë–≥–∫–∏–π",
        lvMid: "–°—Ä–µ–¥–Ω–∏–π",
        lvHard: "–¢—è–∂—ë–ª—ã–π",
        start: "–ù–∞—á–∞—Ç—å",
        exit: "–í—ã–π—Ç–∏",
        turn: "–•–æ–¥",
        mustCapture: "–í–∑—è—Ç–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!",
        youWin: "–í—ã –ø–æ–±–µ–¥–∏–ª–∏! üéâ",
        youLose: "–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ üôÇ",
        draw: "–ù–∏—á—å—è",
        again: "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞",
        menu: "–ú–µ–Ω—é",
        rules: "‚úÖ –ü—Ä–∞–≤–∏–ª–∞: –≤–∑—è—Ç–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –º—É–ª—å—Ç–∏-–≤–∑—è—Ç–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –¥–∞–º–∫–∞ —Ç–æ–∂–µ —Å–Ω–∏–º–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–∑—è—Ç–∏–∏.",
      }
    };

    let lang = "uz";
    const el = (id) => document.getElementById(id);

    const screens = { home: el("home"), quiz: el("quiz"), checkers: el("checkers") };
    function show(name){
      Object.values(screens).forEach(s=>s.classList.remove("active"));
      screens[name].classList.add("active");
      window.scrollTo({top:0, behavior:"instant"});
    }

    function applyLang(){
      const t = I18N[lang];
      el("topTitle").textContent = t.topTitle;
      el("topSub").textContent = t.topSub;
      el("blockTitle").textContent = t.blockTitle;
      el("geoTitle").textContent = t.geoTitle;
      el("geoDesc").textContent = t.geoDesc;
      el("mathTitle").textContent = t.mathTitle;
      el("mathDesc").textContent = t.mathDesc;
      el("aniTitle").textContent = t.aniTitle;
      el("aniDesc").textContent = t.aniDesc;
      el("gamesTitle").textContent = t.gamesTitle;
      el("checkTitle").textContent = t.checkTitle;
      el("checkDesc").textContent = t.checkDesc;
      el("author").textContent = t.author;

      el("ballText").textContent = t.ball;
      el("qText").textContent = t.q;
      el("homeText").textContent = t.home;
      el("homeText2").textContent = t.home;
      el("hint").textContent = t.hint;

      // checkers
      el("checkersHead").textContent = t.checkTitle;
      el("modeLabel").textContent = t.mode;
      el("friendText").textContent = t.friend;
      el("robotText").textContent = t.robot;
      el("p1Label").textContent = t.p1;
      el("p2Label").textContent = t.p2;
      el("levelLabel").textContent = t.level;
      el("lvEasy").textContent = t.lvEasy;
      el("lvMid").textContent = t.lvMid;
      el("lvHard").textContent = t.lvHard;
      el("startText").textContent = t.start;
      el("exitText").textContent = t.exit;
      el("againText").textContent = t.again;
      el("menuText").textContent = t.menu;
      el("rulesNote").textContent = t.rules;
    }

    el("btnUz").addEventListener("click", () => {
      lang="uz";
      el("btnUz").classList.add("active");
      el("btnRu").classList.remove("active");
      applyLang();
      if(screens.quiz.classList.contains("active")) renderQuiz();
      updateTurnInfo();
    });
    el("btnRu").addEventListener("click", () => {
      lang="ru";
      el("btnRu").classList.add("active");
      el("btnUz").classList.remove("active");
      applyLang();
      if(screens.quiz.classList.contains("active")) renderQuiz();
      updateTurnInfo();
    });

    // ===== QUIZ BANKS (10 each) =====
    function q(uzQ, ruQ, uzA, ruA, correct){ return { uzQ, ruQ, uzA, ruA, correct }; }

    function makeQuizGeo(){
      return [
        q("O‚Äòzbekiston poytaxti qaysi shahar? üèôÔ∏è", "–°—Ç–æ–ª–∏—Ü–∞ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–∞? üèôÔ∏è", ["Samarqand","Toshkent","Buxoro","Xiva"], ["–°–∞–º–∞—Ä–∫–∞–Ω–¥","–¢–∞—à–∫–µ–Ω—Ç","–ë—É—Ö–∞—Ä–∞","–•–∏–≤–∞"], 1),
        q("Yerning eng katta okeani qaysi? üåä", "–ö–∞–∫–æ–π —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –æ–∫–µ–∞–Ω? üåä", ["Hind","Atlantika","Tinch","Shimoliy Muz"], ["–ò–Ω–¥–∏–π—Å–∫–∏–π","–ê—Ç–ª–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π","–¢–∏—Ö–∏–π","–°–µ–≤–µ—Ä–Ω—ã–π –õ–µ–¥–æ–≤–∏—Ç—ã–π"], 2),
        q("Dunyoning eng baland tog‚Äòi? üèîÔ∏è", "–°–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è –≥–æ—Ä–∞? üèîÔ∏è", ["Everest","Elbrus","Kilimanjaro","Mont-Blan"], ["–≠–≤–µ—Ä–µ—Å—Ç","–≠–ª—å–±—Ä—É—Å","–ö–∏–ª–∏–º–∞–Ω–¥–∂–∞—Ä–æ","–ú–æ–Ω–±–ª–∞–Ω"], 0),
        q("Avstraliya qaysi qit‚Äôa? üåè", "–ê–≤—Å—Ç—Ä–∞–ª–∏—è ‚Äî —ç—Ç–æ –∫–∞–∫–æ–π –º–∞—Ç–µ—Ä–∏–∫? üåè", ["Osiyo","Yevropa","Avstraliya","Afrika"], ["–ê–∑–∏—è","–ï–≤—Ä–æ–ø–∞","–ê–≤—Å—Ç—Ä–∞–ª–∏—è","–ê—Ñ—Ä–∏–∫–∞"], 2),
        q("Ekvator nima? üìè", "–ß—Ç–æ —Ç–∞–∫–æ–µ —ç–∫–≤–∞—Ç–æ—Ä? üìè", ["0¬∞ kenglik chizig‚Äòi","0¬∞ uzunlik","Tog‚Äò tizmasi","Daryo"], ["–õ–∏–Ω–∏—è 0¬∞ —à–∏—Ä–æ—Ç—ã","0¬∞ –¥–æ–ª–≥–æ—Ç—ã","–ì–æ—Ä–Ω—ã–π —Ö—Ä–µ–±–µ—Ç","–†–µ–∫–∞"], 0),
        q("Kompas nimani ko‚Äòrsatadi? üß≠", "–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–º–ø–∞—Å? üß≠", ["Vaqt","Tezlik","Harorat","Yo‚Äònalish"], ["–í—Ä–µ–º—è","–°–∫–æ—Ä–æ—Å—Ç—å","–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É","–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"], 3),
        q("Materiklar nechta? üåç", "–°–∫–æ–ª—å–∫–æ –º–∞—Ç–µ—Ä–∏–∫–æ–≤? üåç", ["4","5","6","7"], ["4","5","6","7"], 2),
        q("Sahro nima? üèúÔ∏è", "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø—É—Å—Ç—ã–Ω—è? üèúÔ∏è", ["Nam joy","Quruq, kam yog‚Äòin joy","Faqat o‚Äòrmon","Faqat tog‚Äò"], ["–í–ª–∞–∂–Ω–æ–µ –º–µ—Å—Ç–æ","–°—É—Ö–æ–µ –º–µ—Å—Ç–æ —Å –º–∞–ª—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ—Å–∞–¥–∫–æ–≤","–¢–æ–ª—å–∫–æ –ª–µ—Å","–¢–æ–ª—å–∫–æ –≥–æ—Ä—ã"], 1),
        q("Daryo qayerga quyiladi? üåä", "–ö—É–¥–∞ –≤–ø–∞–¥–∞–µ—Ç —Ä–µ–∫–∞? üåä", ["Ko‚Äòlga yoki dengizga","Faqat tog‚Äòga","Faqat cho‚Äòlga","Faqat o‚Äòrmonga"], ["–í –æ–∑–µ—Ä–æ –∏–ª–∏ –º–æ—Ä–µ","–¢–æ–ª—å–∫–æ –≤ –≥–æ—Ä—ã","–¢–æ–ª—å–∫–æ –≤ –ø—É—Å—Ç—ã–Ω—é","–¢–æ–ª—å–∫–æ –≤ –ª–µ—Å"], 0),
        q("Globus nima? üåê", "–ß—Ç–æ —Ç–∞–∫–æ–µ –≥–ª–æ–±—É—Å? üåê", ["Tog`","Daryo xaritasi","Ob-havo","Yer sharining modeli"], ["–ì–æ—Ä–∞","–ö–∞—Ä—Ç–∞ —Ä–µ–∫–∏","–ü–æ–≥–æ–¥–∞","–ú–æ–¥–µ–ª—å –ó–µ–º–ª–∏"], 3),
      ];
    }
    function makeQuizMath(){
      return [
        q("2 + 2 = ?", "2 + 2 = ?", ["4","3","5","6"], ["4","3","5","6"], 0),
        q("5 + 3 = ?", "5 + 3 = ?", ["9","8","7","10"], ["9","8","7","10"], 1),
        q("10 - 6 = ?", "10 - 6 = ?", ["2","3","5","4"], ["2","3","5","4"], 3),
        q("9 - 3 = ?", "9 - 3 = ?", ["5","6","7","8"], ["5","6","7","8"], 1),
        q("3 + 7 = ?", "3 + 7 = ?", ["10","9","11","12"], ["10","8","11","12"], 0),
        q("6 + 1 = ?", "6 + 1 = ?", ["5","6","7","8"], ["5","6","7","8"], 2),
        q("8 - 5 = ?", "8 - 5 = ?", ["2","3","4","5"], ["2","3","4","5"], 1),
        q("4 + 4 = ?", "4 + 4 = ?", ["6","7","8","9"], ["6","7","8","9"], 2),
        q("7 - 2 = ?", "7 - 2 = ?", ["4","5","6","7"], ["4","5","6","7"], 1),
        q("10 -8 = ?", "10 - 8 = ?", ["6","4","3","2"], ["6","4","3","2"], 3),
      ];
    }
    function makeQuizAnimals(){
      return [
        q("Qaysi hayvon 'miyov' deydi? ", "–ö—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç ¬´–º—è—É¬ª? ", ["It","Mushuk","Sigir","Ot"], ["–°–æ–±–∞–∫–∞","–ö–æ—à–∫–∞","–ö–æ—Ä–æ–≤–∞","–õ–æ—à–∞–¥—å"], 1),
        q("Qaysi hayvon suvda yaxshi suzadi? ", "–ö—Ç–æ —Ö–æ—Ä–æ—à–æ –ø–ª–∞–≤–∞–µ—Ç? ", ["Pingvin","Tovuq","Quyon","Mushuk"], ["–ü–∏–Ω–≥–≤–∏–Ω","–ö—É—Ä–∏—Ü–∞","–ö—Ä–æ–ª–∏–∫","–ö–æ—à–∫–∞"], 0),
        q("Eng katta quruqlik hayvoni? ", "–°–∞–º–æ–µ –±–æ–ª—å—à–æ–µ —Å—É—Ö–æ–ø—É—Ç–Ω–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ? ", ["Tulki","Bo‚Äòri","Fil","Ayiq"], ["–õ–∏—Å–∞","–í–æ–ª–∫","–°–ª–æ–Ω","–ú–µ–¥–≤–µ–¥—å"], 2),
        q("Qaysi hayvon asalni yaxshi ko‚Äòradi? ", "–ö—Ç–æ –ª—é–±–∏—Ç –º—ë–¥? ", ["Baliq","Sher","Ot","Ayiq"], ["–†—ã–±–∞","–õ–µ–≤","–õ–æ—à–∞–¥—å","–ú–µ–¥–≤–µ–¥—å"], 3),
        q("Qaysi hayvon uchadi? ", "–ö—Ç–æ –ª–µ—Ç–∞–µ—Ç? ", ["Tulki","Burgut","Ot","Ilon"], ["–õ–∏—Å–∞","–û—Ä—ë–ª","–õ–æ—à–∞–¥—å","–ó–º–µ—è"], 1),
        q("Qaysi hayvon sakraydi? ", "–ö—Ç–æ –ø—Ä—ã–≥–∞–µ—Ç? ", ["Toshbaqa","Ayiq","Kenguru","Qo‚Äòy"], ["–ß–µ—Ä–µ–ø–∞—Ö–∞","–ú–µ–¥–≤–µ–¥—å","–ö–µ–Ω–≥—É—Ä—É","–û–≤—Ü–∞"], 2),
        q("Qaysi hayvon sut beradi? ", "–ö—Ç–æ –¥–∞—ë—Ç –º–æ–ª–æ–∫–æ? ", ["Baliq","Sigir","Qush","Ilon"], ["–†—ã–±–∞","–ö–æ—Ä–æ–≤–∞","–ü—Ç–∏—Ü–∞","–ó–º–µ—è"], 1),
        q("Qaysi hayvon uyda yashaydi? ", "–ö—Ç–æ –∂–∏–≤—ë—Ç –¥–æ–º–∞? ", ["It","Yo‚Äòlbars","Ayiq","Qoplon"], ["–°–æ–±–∞–∫–∞","–¢–∏–≥—Ä","–ú–µ–¥–≤–µ–¥—å","–õ–µ–æ–ø–∞—Ä–¥"], 0),
        q("Qaysi hayvon sekin yuradi? ", "–ö—Ç–æ —Ö–æ–¥–∏—Ç –º–µ–¥–ª–µ–Ω–Ω–æ? ", ["Quyon","Ot","It","Toshbaqa"], ["–ö—Ä–æ–ª–∏–∫","–õ–æ—à–∞–¥—å","–°–æ–±–∞–∫–∞","–ß–µ—Ä–µ–ø–∞—Ö–∞"], 3),
        q("Qaysi hayvon asalari uyasida bo‚Äòladi? ", "–ö—Ç–æ –∂–∏–≤—ë—Ç –≤ —É–ª—å–µ? ", ["Asalari","Mushuk","It","Ayiq"], ["–ü—á–µ–ª–∞","–ö–æ—à–∫–∞","–°–æ–±–∞–∫–∞","–ú–µ–¥–≤–µ–¥—å"], 0),
      ];
    }

    // ===== Quiz runtime =====
    let quiz = [];
    let qIdx = 0;
    let qScore = 0;
    let qLocked = false;
    let qTimer = null;
    const letters = ["A","B","C","D"];

    function startQuiz(bank){
      quiz = bank();
      qIdx = 0;
      qScore = 0;
      el("score").textContent = qScore;
      el("qtotal").textContent = quiz.length;
      show("quiz");
      renderQuiz();
    }

    function renderQuiz(){
      qLocked = false;
      el("state").textContent = "";
      const item = quiz[qIdx];
      el("qnum").textContent = qIdx + 1;
      el("bar").style.width = Math.round((qIdx / quiz.length) * 100) + "%";
      el("question").textContent = (lang === "uz") ? item.uzQ : item.ruQ;

      const ans = (lang === "uz") ? item.uzA : item.ruA;
      const box = el("answers");
      box.innerHTML = "";

      ans.forEach((txt, i) => {
        const b = document.createElement("button");
        b.className = "ans";
        b.innerHTML = `
          <div class="left">
            <div class="badge">${letters[i]}</div>
            <div style="font-weight:1000">${txt}</div>
          </div>
          <div style="font-size:18px">‚≠ê</div>
        `;
        b.addEventListener("click", () => chooseQuiz(i));
        box.appendChild(b);
      });
    }

    // No reveal correct answer; auto-next
    function chooseQuiz(choice){
      if(qLocked) return;
      qLocked = true;

      const t = I18N[lang];
      const item = quiz[qIdx];
      const buttons = Array.from(el("answers").querySelectorAll("button"));
      buttons.forEach(b=>b.disabled = true);

      if(choice === item.correct){
        qScore++;
        el("score").textContent = qScore;
        el("state").textContent = t.correctMsg;
      } else {
        el("state").textContent = t.wrongMsg;
      }

      clearTimeout(qTimer);
      qTimer = setTimeout(() => {
        qIdx++;
        if(qIdx < quiz.length){
          renderQuiz();
        } else {
          showQuizResult();
        }
      }, 650);
    }

    function showQuizResult(){
      el("bar").style.width = "100%";
      const t = I18N[lang];
      const percent = Math.round((qScore / quiz.length) * 100);

      el("answers").innerHTML = "";
      el("question").textContent = t.doneTitle;
      el("state").innerHTML = `${t.doneText}: ${qScore}/${quiz.length} (${percent}%)`;

      const replay = document.createElement("button");
      replay.className = "ans";
      replay.innerHTML = `
        <div class="left">
          <div class="badge">üîÑ</div>
          <div style="font-weight:1000">${t.replay}</div>
        </div>
        <div style="font-size:18px">‚û°Ô∏è</div>
      `;
      replay.addEventListener("click", () => {
        qIdx = 0; qScore = 0;
        el("score").textContent = 0;
        renderQuiz();
      });
      el("answers").appendChild(replay);
    }

    // navigation
    el("goGeo").addEventListener("click", ()=>startQuiz(makeQuizGeo));
    el("goMath").addEventListener("click", ()=>startQuiz(makeQuizMath));
    el("goAnimals").addEventListener("click", ()=>startQuiz(makeQuizAnimals));
    el("backHome").addEventListener("click", ()=>show("home"));

    // ===== CHECKERS GAME =====
    // pieces: 0 empty, 1 player1 man, 2 player2 man, 3 player1 king, 4 player2 king
    let mode = "friend"; // friend | robot
    let level = "easy";
    let p1 = "Player 1";
    let p2 = "Player 2";
    let turn = 1; // 1 or 2
    let board = [];
    let selected = null; // {r,c}
    let forcedPiece = null; // when multi-capture is forced for same piece
    let legalMoves = []; // cached legal moves for current player
    let busy = false; // robot thinking

    const boardEl = el("board");
    const boardScreen = el("boardScreen");
    const endModal = el("endModal");

    // mode UI
    const modeFriend = el("modeFriend");
    const modeRobot = el("modeRobot");
    const p2Field = el("p2Field");
    const levelField = el("levelField");

    modeFriend.addEventListener("click", () => {
      mode = "friend";
      modeFriend.classList.add("active");
      modeRobot.classList.remove("active");
      p2Field.style.display = "";
      levelField.style.display = "none";
    });
    modeRobot.addEventListener("click", () => {
      mode = "robot";
      modeRobot.classList.add("active");
      modeFriend.classList.remove("active");
      p2Field.style.display = "none";
      levelField.style.display = "";
    });

    el("goCheckers").addEventListener("click", ()=>show("checkers"));
    el("backHome2").addEventListener("click", ()=>show("home"));

    el("startCheckers").addEventListener("click", () => {
      p1 = (el("p1Name").value || "Player 1").trim();
      p2 = (mode === "friend")
        ? ((el("p2Name").value || "Player 2").trim())
        : ((lang === "uz") ? "Robot" : "–†–æ–±–æ—Ç");
      level = el("level").value;

      startCheckers();
    });

    el("exitBoard").addEventListener("click", () => {
      closeBoard();
      show("checkers");
    });

    el("playAgain").addEventListener("click", () => {
      endModal.classList.remove("active");
      startCheckers();
    });
    el("goMenu").addEventListener("click", () => {
      endModal.classList.remove("active");
      closeBoard();
      show("home");
    });

    function startCheckers(){
      initBoard();
      turn = 1;
      selected = null;
      forcedPiece = null;
      busy = false;
      openBoard();
      computeLegalMoves();
      renderBoard();
      updateTurnInfo();
      maybeRobotMove();
    }

    function openBoard(){
      boardScreen.classList.add("active");
      document.body.style.overflow = "hidden";
    }
    function closeBoard(){
      boardScreen.classList.remove("active");
      document.body.style.overflow = "";
    }

    function initBoard(){
      // 8x8
      board = Array.from({length:8}, ()=>Array(8).fill(0));
      // player2 on top (rows 0-2) on dark squares
      for(let r=0;r<3;r++){
        for(let c=0;c<8;c++){
          if((r+c)%2===1) board[r][c] = 2;
        }
      }
      // player1 bottom (rows 5-7)
      for(let r=5;r<8;r++){
        for(let c=0;c<8;c++){
          if((r+c)%2===1) board[r][c] = 1;
        }
      }
    }

    function isOwn(piece, player){
      return player===1 ? (piece===1 || piece===3) : (piece===2 || piece===4);
    }
    function isEnemy(piece, player){
      return player===1 ? (piece===2 || piece===4) : (piece===1 || piece===3);
    }
    function isKing(piece){ return piece===3 || piece===4; }

    function dirsFor(piece, player){
      // men move forward only; kings both directions
      if(isKing(piece)) return [[-1,-1],[-1,1],[1,-1],[1,1]];
      return player===1 ? [[-1,-1],[-1,1]] : [[1,-1],[1,1]];
    }

    function cloneBoard(b){ return b.map(row => row.slice()); }

    function inBounds(r,c){ return r>=0 && r<8 && c>=0 && c<8; }

    function getAllCaptures(b, player){
      const caps = [];
      for(let r=0;r<8;r++){
        for(let c=0;c<8;c++){
          const piece = b[r][c];
          if(!isOwn(piece, player)) continue;
          const pieceCaps = getCapturesFrom(b, player, r, c);
          for(const m of pieceCaps) caps.push(m);
        }
      }
      return caps;
    }

    function getCapturesFrom(b, player, r, c){
      const piece = b[r][c];
      const res = [];
      const dirs = dirsFor(piece, player);
      for(const [dr,dc] of dirs){
        const mr = r + dr, mc = c + dc;
        const lr = r + 2*dr, lc = c + 2*dc;
        if(!inBounds(lr,lc) || !inBounds(mr,mc)) continue;
        if(isEnemy(b[mr][mc], player) && b[lr][lc]===0){
          res.push({
            from:{r,c},
            to:{r:lr,c:lc},
            capture:{r:mr,c:mc}
          });
        }
      }
      return res;
    }

    function getAllQuietMoves(b, player){
      const moves = [];
      for(let r=0;r<8;r++){
        for(let c=0;c<8;c++){
          const piece = b[r][c];
          if(!isOwn(piece, player)) continue;
          const dirs = dirsFor(piece, player);
          for(const [dr,dc] of dirs){
            const nr = r + dr, nc = c + dc;
            if(!inBounds(nr,nc)) continue;
            if(b[nr][nc]===0){
              moves.push({from:{r,c}, to:{r:nr,c:nc}, capture:null});
            }
          }
        }
      }
      return moves;
    }

    function applyMove(b, move, player){
      const nb = cloneBoard(b);
      const piece = nb[move.from.r][move.from.c];
      nb[move.from.r][move.from.c] = 0;
      nb[move.to.r][move.to.c] = piece;

      if(move.capture){
        // remove captured piece (damka removed too)
        nb[move.capture.r][move.capture.c] = 0;
      }

      // promotion
      if(piece===1 && move.to.r===0) nb[move.to.r][move.to.c] = 3;
      if(piece===2 && move.to.r===7) nb[move.to.r][move.to.c] = 4;

      return nb;
    }

    function computeLegalMoves(){
      // forced capture rule
      if(forcedPiece){
        // only captures from that piece
        const caps = getCapturesFrom(board, turn, forcedPiece.r, forcedPiece.c);
        legalMoves = caps;
        return;
      }
      const captures = getAllCaptures(board, turn);
      if(captures.length>0){
        legalMoves = captures;
      } else {
        legalMoves = getAllQuietMoves(board, turn);
      }
    }

    function updateTurnInfo(){
      const t = I18N[lang];
      const name = turn===1 ? p1 : p2;
      const vs = (mode==="robot") ? ((lang==="uz") ? "Robot" : "–†–æ–±–æ—Ç") : ((lang==="uz") ? "Do‚Äòst" : "–î—Ä—É–≥");
      const capRequired = getAllCaptures(board, turn).length>0 || (forcedPiece && legalMoves.length>0);
      el("turnInfo").innerHTML = `üéØ ${t.turn}: <b>${name}</b> ‚Ä¢ ${capRequired ? "üî• " + t.mustCapture : "‚úÖ"}`;
    }

    function renderBoard(){
      boardEl.innerHTML = "";
      const movesForSel = selected ? legalMoves.filter(m => m.from.r===selected.r && m.from.c===selected.c) : [];
      for(let r=0;r<8;r++){
        for(let c=0;c<8;c++){
          const cell = document.createElement("div");
          cell.className = "cell " + (((r+c)%2===0) ? "light" : "dark");
          cell.dataset.r = r;
          cell.dataset.c = c;

          // clickable only on dark squares
          if((r+c)%2===1){
            cell.addEventListener("click", () => onCellClick(r,c));
          }

          // move hint
          if(selected){
            const isHint = movesForSel.find(m => m.to.r===r && m.to.c===c);
            if(isHint){
              const dot = document.createElement("div");
              dot.className = "hintMove" + (isHint.capture ? " hintCapture" : "");
              cell.appendChild(dot);
            }
          }

          const piece = board[r][c];
          if(piece!==0){
            const p = document.createElement("div");
            p.className = "piece " + ((piece===1 || piece===3) ? "p1" : "p2");
            if(isKing(piece)) p.classList.add("king");
            if(selected && selected.r===r && selected.c===c) p.classList.add("selected");

            if(isKing(piece)){
              const cr = document.createElement("div");
              cr.className = "crown";
              cr.textContent = "üëë";
              p.appendChild(cr);
            }

            cell.appendChild(p);
          }

          boardEl.appendChild(cell);
        }
      }
      updateTurnInfo();
    }

    function onCellClick(r,c){
      if(busy) return;

      const piece = board[r][c];

      // if selecting a piece
      if(isOwn(piece, turn)){
        // if forced piece exists, only that one selectable
        if(forcedPiece && (forcedPiece.r!==r || forcedPiece.c!==c)) return;
        selected = {r,c};
        renderBoard();
        return;
      }

      // if clicking empty and have selected piece -> try to move
      if(selected){
        const candidate = legalMoves.find(m => m.from.r===selected.r && m.from.c===selected.c && m.to.r===r && m.to.c===c);
        if(candidate){
          doMove(candidate);
        }
      }
    }

    function doMove(move){
      board = applyMove(board, move, turn);

      // after capture, check multi-capture from new position
      if(move.capture){
        const moreCaps = getCapturesFrom(board, turn, move.to.r, move.to.c);
        if(moreCaps.length>0){
          forcedPiece = {r: move.to.r, c: move.to.c};
          selected = forcedPiece;
          computeLegalMoves();
          renderBoard();

          // if robot, continue automatically
          if(mode==="robot" && turn===2){
            setTimeout(maybeRobotMove, 180);
          }
          return;
        }
      }

      // end of turn
      forcedPiece = null;
      selected = null;
      switchTurn();
    }

    function switchTurn(){
      turn = (turn===1) ? 2 : 1;
      computeLegalMoves();
      renderBoard();
      checkEnd();
      maybeRobotMove();
    }

    function countPieces(b, player){
      let n=0;
      for(let r=0;r<8;r++) for(let c=0;c<8;c++) if(isOwn(b[r][c], player)) n++;
      return n;
    }

    function hasAnyMoves(b, player){
      if(getAllCaptures(b, player).length>0) return true;
      return getAllQuietMoves(b, player).length>0;
    }

    function checkEnd(){
      const t = I18N[lang];
      const p1Count = countPieces(board, 1);
      const p2Count = countPieces(board, 2);

      if(p1Count===0 || !hasAnyMoves(board, 1)){
        // player2 wins
        endGame(turn===1 ? t.youLose : (mode==="robot" ? t.youLose : t.youLose), 2);
      }
      if(p2Count===0 || !hasAnyMoves(board, 2)){
        // player1 wins
        endGame(t.youWin, 1);
      }
    }

    function endGame(message, winner){
      const t = I18N[lang];
      el("endTitle").textContent = message;
      el("endSub").textContent = (winner===1) ? `${p1}` : `${p2}`;
      endModal.classList.add("active");
      busy = false;
    }

    // ===== ROBOT AI =====
    function maybeRobotMove(){
      if(mode!=="robot") return;
      if(turn!==2) return;
      if(endModal.classList.contains("active")) return;

      // compute moves already in legalMoves
      computeLegalMoves();
      if(legalMoves.length===0) return;

      busy = true;
      setTimeout(() => {
        const move = pickRobotMove();
        busy = false;
        if(move) doMove(move);
      }, 200);
    }

    function pickRobotMove(){
      // easy: random legal
      // mid: prefer captures and piece gain heuristic 1-ply
      // hard: minimax depth
      if(level==="easy"){
        return legalMoves[Math.floor(Math.random()*legalMoves.length)];
      }
      if(level==="mid"){
        return bestByHeuristic(legalMoves, 2);
      }
      return bestByMinimax(legalMoves);
    }

    function evaluate(b){
      // positive good for player2 (robot)
      let score=0;
      for(let r=0;r<8;r++){
        for(let c=0;c<8;c++){
          const p = b[r][c];
          if(p===2) score += 10;
          if(p===4) score += 14;
          if(p===1) score -= 10;
          if(p===3) score -= 14;
        }
      }
      return score;
    }

    function bestByHeuristic(moves, player){
      let best = null;
      let bestVal = -1e9;
      for(const m of moves){
        const nb = applyMove(board, m, player);
        let v = evaluate(nb);
        // small bonus for capture
        if(m.capture) v += 4;
        if(v>bestVal){
          bestVal=v;
          best=m;
        }
      }
      return best || moves[0];
    }

    function getLegalMovesFor(b, player, forced=null){
      if(forced){
        const caps = getCapturesFrom(b, player, forced.r, forced.c);
        return caps;
      }
      const caps = getAllCaptures(b, player);
      if(caps.length>0) return caps;
      return getAllQuietMoves(b, player);
    }

    function bestByMinimax(moves){
      const depth =  (level==="hard") ? 5 : 3;
      let best = null;
      let bestScore = -1e9;

      for(const m of moves){
        let nb = applyMove(board, m, 2);
        let forced = null;

        // if capture and more captures => robot continues in same turn (simulate)
        if(m.capture){
          const more = getCapturesFrom(nb, 2, m.to.r, m.to.c);
          if(more.length>0){
            forced = {r:m.to.r, c:m.to.c};
          }
        }

        const s = minimax(nb, depth-1, false, -1e9, 1e9, forced);
        if(s>bestScore){
          bestScore=s;
          best=m;
        }
      }
      return best || moves[0];
    }

    function minimax(b, depth, robotTurn, alpha, beta, forcedPieceLocal){
      // robotTurn: true means player2, false means player1
      if(depth<=0) return evaluate(b);

      const player = robotTurn ? 2 : 1;
      const moves = getLegalMovesFor(b, player, forcedPieceLocal);

      // terminal
      if(countPieces(b,1)===0 || !hasAnyMoves(b,1)) return 9999;
      if(countPieces(b,2)===0 || !hasAnyMoves(b,2)) return -9999;
      if(moves.length===0) return evaluate(b);

      if(robotTurn){
        let best = -1e9;
        for(const m of moves){
          let nb = applyMove(b, m, 2);

          // if robot captures and can capture again -> stays robotTurn with forced
          let forced = null;
          let nextRobotTurn = false;
          if(m.capture){
            const more = getCapturesFrom(nb, 2, m.to.r, m.to.c);
            if(more.length>0){
              forced = {r:m.to.r, c:m.to.c};
              nextRobotTurn = true;
            }
          }
          const val = minimax(nb, depth-1, nextRobotTurn ? true : false, alpha, beta, forced);
          best = Math.max(best, val);
          alpha = Math.max(alpha, best);
          if(beta<=alpha) break;
        }
        return best;
      } else {
        let best = 1e9;
        for(const m of moves){
          let nb = applyMove(b, m, 1);

          // if player1 captures and can capture again -> stays player1 with forced
          let forced = null;
          let nextRobotTurn = true;
          if(m.capture){
            const more = getCapturesFrom(nb, 1, m.to.r, m.to.c);
            if(more.length>0){
              forced = {r:m.to.r, c:m.to.c};
              nextRobotTurn = false;
            }
          }
          const val = minimax(nb, depth-1, nextRobotTurn, alpha, beta, forced);
          best = Math.min(best, val);
          beta = Math.min(beta, best);
          if(beta<=alpha) break;
        }
        return best;
      }
    }

    // ===== navigation (home) =====
    el("goGeo").addEventListener("click", ()=>startQuiz(makeQuizGeo));
    el("goMath").addEventListener("click", ()=>startQuiz(makeQuizMath));
    el("goAnimals").addEventListener("click", ()=>startQuiz(makeQuizAnimals));
    el("backHome").addEventListener("click", ()=>show("home"));

    // ===== initial =====
    applyLang();
  </script>
</body>
</html>


